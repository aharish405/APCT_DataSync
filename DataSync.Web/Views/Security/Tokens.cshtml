@using NonFactors.Mvc.Grid
@model IQueryable<DataSync.Core.Models.RefreshToken>

@{
    ViewData["Title"] = "Refresh Tokens";
}

<div class="card shadow-sm">
    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
        <h5 class="mb-0 text-primary fw-bold"><i class="bi bi-key"></i> Active Refresh Tokens</h5>
        <a asp-action="Index" class="btn btn-sm btn-secondary">Back to Clients</a>
    </div>
    <div class="card-body">
        @(Html
            .Grid(Model)
            .Build(columns =>
            {
                columns.Add(model => "").Titled("#").Css("row-number-col");
                columns.Add(model => model.AppId).Titled("Client ID");
                columns.Add(model => model.Created).Titled("Created").Formatted("{0:g}");
                columns.Add(model => model.Expires).Titled("Expires").Formatted("{0:g}");
                columns.Add(model => model.IsActive).Titled("Status").RenderedAs(model => model.IsActive ? "<span class='badge bg-success'>Active</span>" : "<span class='badge bg-secondary'>Revoked/Expired</span>").Encoded(false);
                columns.Add(model => model.IsActive ? Html.Raw($"<form action='{Url.Action("RevokeToken", "Security", new { id = model.Id })}' method='post' style='display:inline;' onsubmit='return confirm(\"Are you sure you want to revoke this token?\");'><button type='submit' class='btn btn-danger btn-sm'>Revoke</button></form>") : Html.Raw("")).Titled("Actions").Encoded(false);
            })
            .Using(GridFilterMode.Header)
            .Empty("No tokens found")
            .Filterable()
            .Sortable()
            .Pageable(pager =>
            {
                pager.PageSizes = new Dictionary<Int32, String> { { 0, "All" }, { 10, "10" }, { 20, "20" }, { 50, "50" }, { 100, "100" }, { 500, "500" }, { 1000, "1000" } };
                pager.ShowPageSizes = true;
                pager.RowsPerPage = 20;
            })
        )
    </div>
</div>
